<%= render "shared/content_title", title_var: "User Search" %>

<%= form_tag(search_users_path, :method => "get") do %>
	<div class="control-group">
		<%= label_tag(:uname, "Search for user:") %>
		<%= text_field_tag(:uname, params[:uname] || "<enter search here>") %>
	</div>

	<div class="control-group">
		<%= label_tag(:with_posts, "With at least one post") %>
		<%= check_box_tag(:with_posts, "1", @with_posts_val == "1") %>
	</div>

	<div class="control-group">
		<%= label_tag(:sorting, "Sort by") %>
		<%= select_tag(:sorting, options_for_select(@sort_options_array, @sorting_val)) %>
	</div>

	<br>
	<%= submit_tag("Search") %>
<% end %>

<!-- we may already have search results, so display them here -->
<hr/>

<% if params[:uname] && (params[:uname].size > 0) %>
	<!-- this is a hint that a search has occurred -->
	<!-- now we have to figure out whether any results matched our query -->
	<% if @search_results.size == 0 %>
		<!-- no results match, so give feedback that we DID do a search but nothing was found -->
		<h4>No users match your search</h4>
	<% else %>
		<!-- we found at least one match, so let's say so -->
		<h4><%= "#{@search_results.size} " + "user".pluralize(@search_results.size) + " found." %></h4>
		<ul>
		<% @search_results.each do |u| %>
			<li>
				<%= "#{u.username} (with " %>
				<% post_string = "#{u.posts.size} " + "post".pluralize(u.posts.size) %>
				<% if u.posts.size > 0 %>
					<%= link_to post_string, posts_user_path(u) %>
				<% else %>
					<%= post_string %>
				<% end %>
				<%= ")" %>
			</li>
		<% end %>
		</ul>
	<% end %>
<% end %>


